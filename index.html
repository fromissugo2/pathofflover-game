<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Path of flover</title>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

  <style>
    body {
      margin: 0;
      background: #000;
    }
  </style>
</head>
<body>

<script>
  const config = {
    type: Phaser.AUTO,
    width: 480,
    height: 270,
    backgroundColor: "#222222",
    physics: {
      default: "arcade",
      arcade: {
        gravity: { y: 600 },
        debug: false
      }
    },
    scene: {
      create,
      update
    }
  };

  new Phaser.Game(config);

  /* =====================
     ìƒìˆ˜ / ìƒíƒœ
  ===================== */
  const GROUND_Y = 220;
  const PLAYER_X = 120;
  const OBSTACLE_X = 300;
  const JUMP_POWER = 260;
  const OBSTACLE_SPEED = 140;

  let player, obstacle, cursors;
  let gameState = "WAITING"; // WAITING | JUMP | FALL | RESULT

  /* =====================
     Scene Create
  ===================== */
  function create() {
    // ë°”ë‹¥
    const ground = this.add.rectangle(0, GROUND_Y, 480, 50, 0x555555);
    ground.setOrigin(0);
    this.physics.add.existing(ground, true);

    // í”Œë ˆì´ì–´
    player = this.add.rectangle(PLAYER_X, GROUND_Y - 20, 16, 24, 0x00ff88);
    this.physics.add.existing(player);
    this.physics.add.collider(player, ground);

    // ì¥ì• ë¬¼
    obstacle = this.add.rectangle(OBSTACLE_X, GROUND_Y - 20, 24, 32, 0xff0000);
    this.physics.add.existing(obstacle, true);

    // ì¶©ëŒ íŒì • (ì˜¤ë‹µ ìƒíƒœì¼ ë•Œë§Œ)
    this.physics.add.collider(player, obstacle, () => {
      if (gameState === "FALL") {
        console.log("âŒ ë„˜ì–´ì§");
        gameState = "RESULT";
        endRound();
      }
    });

    cursors = this.input.keyboard.createCursorKeys();

    console.log("ì½˜ì†”ì—ì„œ correct() ë˜ëŠ” wrong() í˜¸ì¶œí•´ë³´ì„¸ìš”");
  }

  /* =====================
     Update Loop
  ===================== */
  function update() {
    // ì í”„ ì¤‘ì¼ ë•Œë§Œ ì´ë™
    if (gameState === "JUMP") {
      obstacle.x -= OBSTACLE_SPEED * 0.016;

      // ì¥ì• ë¬¼ ë„˜ì—ˆì„ ë•Œ
      if (obstacle.x < PLAYER_X - 40) {
        console.log("â­• ì í”„ ì„±ê³µ");
        gameState = "RESULT";
        endRound();
      }
    }

    // ì˜¤ë‹µì¼ ë•Œ â†’ ì¥ì• ë¬¼ì´ ë‹¤ê°€ì˜´
    if (gameState === "FALL") {
      obstacle.x -= OBSTACLE_SPEED * 0.016;
    }
  }

  /* =====================
     ì™¸ë¶€ íŠ¸ë¦¬ê±° (í€´ì¦ˆ ê²°ê³¼)
  ===================== */
  window.correct = function () {
    if (gameState !== "WAITING") return;

    console.log("ì •ë‹µ!");
    gameState = "JUMP";
    player.body.setVelocityY(-JUMP_POWER);
  };

  window.wrong = function () {
    if (gameState !== "WAITING") return;

    console.log("ì˜¤ë‹µ!");
    gameState = "FALL";
  };

  /* =====================
     ë¼ìš´ë“œ ì¢…ë£Œ & ë¦¬ì…‹
  ===================== */
  function endRound() {
    setTimeout(resetRound, 1000);
  }

  function resetRound() {
    console.log("ğŸ”„ ë¼ìš´ë“œ ë¦¬ì…‹");

    player.x = PLAYER_X;
    player.y = GROUND_Y - 20;
    player.body.setVelocity(0);

    obstacle.x = OBSTACLE_X;

    gameState = "WAITING";
  }
</script>

</body>
</html>
