<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Path of flover</title>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

  <style>
    body {
      margin: 0;
      background: #ffffff;
    }
  </style>
</head>
<body>

<script>
/* ===============================
   ê¸°ë³¸ ì„¤ì •
=============================== */
const WIDTH = 800;
const HEIGHT = 400;
const GROUND_Y = 320;

let player, obstacle;
let gameState = "IDLE";

/* ===============================
   Phaser ì„¤ì •
=============================== */
const config = {
  type: Phaser.AUTO,
  width: WIDTH,
  height: HEIGHT,
  backgroundColor: "#ffffff",
  physics: {
    default: "arcade",
    arcade: {
      gravity: { y: 900 },
      debug: false
    }
  },
  scene: {
    preload,
    create,
    update
  }
};

const game = new Phaser.Game(config);

/* ===============================
   preload
=============================== */
function preload() {
  this.load.image("player", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAFUlEQVRIS2NkYGD4z0AEYBxVSFUAANR+BBcOW0xKAAAAAElFTkSuQmCC");
  this.load.image("obstacle", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAFUlEQVRIS2NkYGD4z0AEYBxVSFUAANR+BBcOW0xKAAAAAElFTkSuQmCC");
}

/* ===============================
   create
=============================== */
function create() {
  // ë°”ë‹¥
  const ground = this.add.rectangle(
    WIDTH / 2,
    GROUND_Y + 20,
    WIDTH,
    40,
    0xffb703
  );
  this.physics.add.existing(ground, true);

  // í”Œë ˆì´ì–´ (ì˜¤ë¥¸ìª½)
  player = this.physics.add.sprite(600, GROUND_Y - 20, "player");
  player.setTint(0x4caf50);
  player.setCollideWorldBounds(true);

  // ìž¥ì• ë¬¼ (ì™¼ìª½, ì¤‘ë ¥ âŒ)
  obstacle = this.physics.add.sprite(200, GROUND_Y - 20, "obstacle");
  obstacle.setTint(0xb0b0b0);

  obstacle.body.setAllowGravity(false); // ðŸ”´ í•µì‹¬
  obstacle.body.setImmovable(true);     // ðŸ”´ í•µì‹¬
  obstacle.setVelocityY(0);             // ðŸ”´ í•µì‹¬

  // ì¶©ëŒ
  this.physics.add.collider(player, ground);
  this.physics.add.collider(obstacle, ground);

  this.physics.add.collider(player, obstacle, () => {
    if (gameState === "FAIL") {
      player.setVelocity(0);
      player.setAngle(90); // ë„˜ì–´ì§
      resetScene(this);
    }
  });

  this.add.text(20, 20, "ì½˜ì†”ì—ì„œ correct() / wrong()", {
    font: "16px Arial",
    fill: "#000"
  });
}

/* ===============================
   update
=============================== */
function update() {
  // ìž¥ì• ë¬¼ì€ ì¢Œìš°ë§Œ ì´ë™
  if (gameState === "SUCCESS" || gameState === "FAIL") {
    obstacle.setVelocityX(200);
    obstacle.setVelocityY(0); // ðŸ”´ Y ê³ ì •
  }
}

/* ===============================
   ì •ë‹µ
=============================== */
window.correct = function () {
  if (gameState !== "IDLE") return;
  gameState = "SUCCESS";

  player.setAngle(0);
  player.setVelocityY(-380);
};

/* ===============================
   ì˜¤ë‹µ
=============================== */
window.wrong = function () {
  if (gameState !== "IDLE") return;
  gameState = "FAIL";

  player.setVelocityY(-260);

  setTimeout(() => {
    player.setAngle(90);
  }, 350);
};

/* ===============================
   ë¦¬ì…‹
=============================== */
function resetScene(scene) {
  setTimeout(() => {
    gameState = "IDLE";
    scene.scene.restart();
  }, 700);
}
</script>

</body>
</html>
