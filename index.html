<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Path of flover</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
  <style>
    body { margin: 0; background: #000; }
  </style>
</head>
<body>

<script>
  const config = {
    type: Phaser.AUTO,
    width: 480,
    height: 270,
    backgroundColor: "#222222",
    physics: {
      default: "arcade",
      arcade: {
        gravity: { y: 600 },
        debug: false
      }
    },
    scene: { create, update }
  };

  new Phaser.Game(config);

  /* ===== ÏÑ§Ï†ï ===== */
  const GROUND_Y = 220;
  const PLAYER_X = 360;     // ‚ñ∂ ÌîåÎ†àÏù¥Ïñ¥ Ïò§Î•∏Ï™Ω
  const OBSTACLE_X = 120;   // ‚óÄ Ïû•Ïï†Î¨º ÏôºÏ™Ω
  const JUMP_POWER = 260;
  const OBSTACLE_SPEED = 140;

  let player, obstacle;
  let gameState = "WAITING"; // WAITING | JUMP | FALL | RESULT

  function create() {
    // Î∞îÎã•
    const ground = this.add.rectangle(0, GROUND_Y, 480, 50, 0x555555);
    ground.setOrigin(0);
    this.physics.add.existing(ground, true);

    // ÌîåÎ†àÏù¥Ïñ¥
    player = this.add.rectangle(PLAYER_X, GROUND_Y - 20, 16, 24, 0x00ff88);
    this.physics.add.existing(player);
    this.physics.add.collider(player, ground);

    // Ïû•Ïï†Î¨º (dynamic body)
    obstacle = this.add.rectangle(OBSTACLE_X, GROUND_Y - 20, 24, 32, 0xff0000);
    this.physics.add.existing(obstacle);
    obstacle.body.setAllowGravity(false);
    obstacle.body.setImmovable(true);

    // Ï∂©Îèå (Ïò§ÎãµÏùº ÎïåÎßå)
    this.physics.add.collider(player, obstacle, () => {
      if (gameState === "FALL") {
        console.log("‚ùå ÎÑòÏñ¥Ïßê");
        gameState = "RESULT";
        endRound();
      }
    });

    console.log("ÏΩòÏÜîÏóêÏÑú correct() ÎòêÎäî wrong() Ïã§Ìñâ");
  }

  function update() {
    if (gameState === "JUMP" || gameState === "FALL") {
      // ‚óÄ‚ñ∂ ÏôºÏ™Ω ‚Üí Ïò§Î•∏Ï™Ω Ïù¥Îèô
      obstacle.x += OBSTACLE_SPEED * 0.016;
      obstacle.body.updateFromGameObject();
    }

    // Ï†êÌîÑ ÏÑ±Í≥µ ÌåêÏ†ï (Ïû•Ïï†Î¨ºÏù¥ ÌîåÎ†àÏù¥Ïñ¥ Ïò§Î•∏Ï™ΩÏùÑ ÏßÄÎÇòÍ∞ÄÎ©¥)
    if (gameState === "JUMP" && obstacle.x > PLAYER_X + 40) {
      console.log("‚≠ï Ï†êÌîÑ ÏÑ±Í≥µ");
      gameState = "RESULT";
      endRound();
    }
  }

  // Ï†ïÎãµ
  window.correct = function () {
    if (gameState !== "WAITING") return;
    gameState = "JUMP";
    player.body.setVelocityY(-JUMP_POWER);
  };

  // Ïò§Îãµ
  window.wrong = function () {
    if (gameState !== "WAITING") return;
    gameState = "FALL";
  };

  function endRound() {
    setTimeout(resetRound, 1000);
  }

  function resetRound() {
    player.x = PLAYER_X;
    player.y = GROUND_Y - 20;
    player.body.setVelocity(0);

    obstacle.x = OBSTACLE_X;
    obstacle.body.updateFromGameObject();

    gameState = "WAITING";
    console.log("üîÑ Îã§Ïùå Î¨∏Ï†ú");
  }
</script>

</body>
</html>
